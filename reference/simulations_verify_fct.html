<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Verify Custom NFL Result Simulation Function — simulations_verify_fct • nflseedR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet"><link href="../deps/Kanit-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Verify Custom NFL Result Simulation Function — simulations_verify_fct"><meta name="description" content="nflseedR supports custom functions to compute results in season simulations
through the argument compute_results in the season simulation function
nfl_simulations. To ensure that custom functions work as nflseedR expects
them to, it is recommended to verify their behavior.
This function first checks the structure of the output and then whether game
results are changed as expected. Whenever a problem is found, the function will
error with a hint to the problem (this means that you might be required to
iterate over all problems until the function stops erroring).
See below detail section for more information on expected behavior."><meta property="og:description" content="nflseedR supports custom functions to compute results in season simulations
through the argument compute_results in the season simulation function
nfl_simulations. To ensure that custom functions work as nflseedR expects
them to, it is recommended to verify their behavior.
This function first checks the structure of the output and then whether game
results are changed as expected. Whenever a problem is found, the function will
error with a hint to the problem (this means that you might be required to
iterate over all problems until the function stops erroring).
See below detail section for more information on expected behavior."><meta property="og:image" content="https://nflseedr.com/reference/figures/gh_preview.png"><meta property="og:image:alt" content="nflseedR social preview card"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@mrcaseb"><meta name="twitter:site" content="@nflfastR"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nflseedR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/nflseedR.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/nflsim.html">Simulating NFL seasons using nflseedR</a></li>
    <li><a class="dropdown-item" href="../articles/nflsim2.html">Simulating NFL seasons using nflseedR 2.0</a></li>
    <li><a class="dropdown-item" href="../articles/tiebreaker.html">NFL Tiebreaking Procedures</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discord.com/invite/5Er2FBnnQa" aria-label="Join Community Discord Server"><span class="fa fab fa-discord fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nflverse/nflseedR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages &amp; More</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages-more"><li><h6 class="dropdown-header" data-toc-skip>nflverse Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.nflfastr.com">nflfastR</a></li>
    <li><a class="dropdown-item" href="https://nflseedr.com">nflseedR</a></li>
    <li><a class="external-link dropdown-item" href="https://www.nfl4th.com">nfl4th</a></li>
    <li><a class="external-link dropdown-item" href="https://nflreadr.nflverse.com/">nflreadr</a></li>
    <li><a class="external-link dropdown-item" href="https://nflplotr.nflverse.com/">nflplotR</a></li>
    <li><a class="external-link dropdown-item" href="https://nflverse.nflverse.com/">nflverse</a></li>
    <li><a class="external-link dropdown-item" href="https://www.opensourcefootball.com">Open Source Football</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>nflverse Data</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nflverse">nflverse GitHub</a></li>
    <li><a class="external-link dropdown-item" href="https://jthomasmock.github.io/espnscrapeR/">espnscrapeR Package</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>ffverse</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.ffverse.com">ffverse.com</a></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Verify Custom NFL Result Simulation Function</h1>
      <small class="dont-index">Source: <a href="https://github.com/nflverse/nflseedR/blob/master/R/simulations_verify_fct.R" class="external-link"><code>R/simulations_verify_fct.R</code></a></small>
      <div class="d-none name"><code>simulations_verify_fct.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>nflseedR supports custom functions to compute results in season simulations
through the argument <code>compute_results</code> in the season simulation function
<a href="nfl_simulations.html">nfl_simulations</a>. To ensure that custom functions work as nflseedR expects
them to, it is recommended to verify their behavior.
This function first checks the structure of the output and then whether game
results are changed as expected. Whenever a problem is found, the function will
error with a hint to the problem (this means that you might be required to
iterate over all problems until the function stops erroring).
See below detail section for more information on expected behavior.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulations_verify_fct</span><span class="op">(</span></span>
<span>  <span class="va">compute_results</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  games <span class="op">=</span> <span class="fu">nflseedR</span><span class="fu">::</span><span class="va"><a href="sims_games_example.html">sims_games_example</a></span>,</span>
<span>  teams <span class="op">=</span> <span class="fu">nflseedR</span><span class="fu">::</span><span class="va"><a href="sims_teams_example.html">sims_teams_example</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-compute-results">compute_results<a class="anchor" aria-label="anchor" href="#arg-compute-results"></a></dt>
<dd><p>A function to compute results of games. See below
detail section for more information on expected behavior.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed on to <code>compute_results</code>.</p></dd>


<dt id="arg-games">games<a class="anchor" aria-label="anchor" href="#arg-games"></a></dt>
<dd><p>An NFL schedule where some results are missing. <code>compute_results</code>
is supposed to compute those results on a weekly base. Defaults to
<a href="sims_games_example.html">sims_games_example</a>. Please see this example to understand
the required data structure.</p></dd>


<dt id="arg-teams">teams<a class="anchor" aria-label="anchor" href="#arg-teams"></a></dt>
<dd><p>A list of teams by simulation number. This is usually calculated
automatically and not user facing. It can be used to "transport" team information
like elo ratings from one simulated week to the next. Defaults to
<a href="sims_teams_example.html">sims_teams_example</a>. Please see this example to understand
the required data structure.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns <code>TRUE</code> invisibly if no problems are found.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following sections detail the requirements for the <code>compute_results</code>
function. If anything is unclear, please see the source code of nflseedR's
default function <code>nflseedR_compute_results</code>.</p><div class="section">
<h3 id="required-function-arguments-of-compute-results">Required Function Arguments of <code>compute_results</code><a class="anchor" aria-label="anchor" href="#required-function-arguments-of-compute-results"></a></h3>


<p>The function passed to <code>compute_results</code> is required to support the arguments
<code>"teams"</code>, <code>"games"</code>, and <code>"week_num"</code>. The two leading ones are already
described above. The latter is a factor with a length of 1, which identifies
the current week. Regular season weeks are labeled <code>"1"</code>, <code>"2"</code>, etc.
Playoff weeks are labeled <code>"WC"</code>, <code>"DIV"</code>, <code>"CON"</code>, and <code>"SB"</code>.</p>
</div>

<div class="section">
<h3 id="required-output-structure-of-compute-results">Required Output Structure of <code>compute_results</code><a class="anchor" aria-label="anchor" href="#required-output-structure-of-compute-results"></a></h3>


<p>The function passed to <code>compute_results</code> is required to return a list of the
two objects <code>"teams"</code> and <code>"games"</code> as passed to it in the arguments of the
same name. The function must not remove rows or columns.
So the last line of <code>compute_results</code> usually looks like</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"teams"</span> <span class="ot">=</span> teams, <span class="st">"games"</span> <span class="ot">=</span> games)</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="required-behavior-of-compute-results-when-computing-game-results">Required Behavior of <code>compute_results</code> when Computing Game Results<a class="anchor" aria-label="anchor" href="#required-behavior-of-compute-results-when-computing-game-results"></a></h3>


<p>nflseedR calls <code>compute_results</code> for every week where a <code>result</code> is missing
in <code>games</code>. The variable <code>result</code> is defined as the point differential between
the home team and the away team. If the home team loses, the value is
therefore &lt; 0, if it wins &gt; 0 and if it ties == 0.
To support elo-based simulations, this is done in a loop so that elo ratings
can be updated based on the results and "transported" from week to week. You
can "transport" ratings or other information by joining them to the <code>"teams"</code>
table.
This behavior requires that <code>compute_results</code> only changes the results of
the current week - called <code>week_num</code>. And only if there is not already a
result.
So <code>compute_results</code> must only compute a result when</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>week <span class="sc">==</span> week_num <span class="sc">&amp;</span> <span class="fu">is.na</span>(result)</span></code></pre><p></p></div>
<p>For the playoffs, there is also the special case that matches cannot end in a
tie (<code>result == 0</code>). In most cases, ties are not simulated anyway because
they occur so rarely. But in the event that they are simulated, they must
not be in the playoffs.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">simulations_verify_fct</span><span class="op">(</span><span class="va">nflseedR_compute_results</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A shallow copy of this data.table was taken so that := can add or remove 1 columns by reference. At an earlier point, this data.table was copied by R (or was created manually using structure() or similar). Avoid names&lt;- and attr&lt;- which in R currently (and oddly) may copy the whole data.table. Use set* syntax instead to avoid copying: ?set, ?setnames and ?setattr. It's also not unusual for data.table-agnostic packages to produce tables affected by this issue. If this message doesn't help, please report your use case to the data.table issue tracker so the root cause can be fixed or this message improved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No problems found!</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://bsky.app/profile/mrcaseb.nflverse.com" class="external-link">Sebastian Carl</a>, <a href="https://twitter.com/LeeSharpeNFL" class="external-link">Lee Sharpe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

